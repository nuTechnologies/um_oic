<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>UM-OIC Administration</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        color: #333;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }

      h1 {
        color: white;
        text-align: center;
        margin-bottom: 30px;
        font-weight: 700;
        font-size: 2.5rem;
        text-shadow: 0 2px 4px rgba(0,0,0,0.2);
      }

      .loading {
        text-align: center;
        color: white;
        font-size: 1.2rem;
        margin: 50px 0;
      }

      .error {
        background: #fed7d7;
        color: #c53030;
        padding: 15px;
        border-radius: 8px;
        margin: 20px 0;
        border: 1px solid #feb2b2;
      }

      .admin-panel {
        display: none;
      }

      /* Navigation */
      nav {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 12px;
        padding: 15px;
        margin-bottom: 30px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        display: flex;
        gap: 10px;
        align-items: center;
        flex-wrap: wrap;
      }

      .nav-btn {
        padding: 10px 16px;
        border: none;
        border-radius: 8px;
        background: #f7fafc;
        color: #4a5568;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 500;
        font-size: 0.9rem;
      }

      .nav-btn:hover {
        background: #e2e8f0;
        transform: translateY(-1px);
      }

      .nav-btn.active {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
      }

      .nav-btn:last-child {
        margin-left: auto;
        background: #dc3545;
        color: white;
      }

      .nav-btn:last-child:hover {
        background: #c82333;
      }

      /* Content Sections */
      .section {
        display: none;
        background: white;
        border-radius: 12px;
        padding: 30px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        backdrop-filter: blur(10px);
      }

      .section.active {
        display: block;
      }

      .section h2 {
        color: #4a5568;
        margin-bottom: 20px;
        font-size: 1.8rem;
        font-weight: 600;
      }

      .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        flex-wrap: wrap;
        gap: 15px;
      }

      /* Buttons */
      .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 12px 20px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
      }

      .btn-secondary, .btn-warning {
        padding: 10px 16px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 500;
        transition: all 0.3s ease;
      }

      .btn-secondary {
        background: #6c757d;
        color: white;
      }

      .btn-secondary:hover {
        background: #5a6268;
        transform: translateY(-1px);
      }

      .btn-warning {
        background: #ffc107;
        color: #212529;
      }

      .btn-warning:hover {
        background: #e0a800;
        transform: translateY(-1px);
      }

      /* Dashboard Stats */
      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin: 20px 0;
      }

      .stat-card {
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        border-radius: 12px;
        padding: 25px;
        text-align: center;
        border: 1px solid #e2e8f0;
        transition: transform 0.3s ease;
      }

      .stat-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 25px rgba(0,0,0,0.1);
      }

      .stat-card h3 {
        font-size: 2.5rem;
        margin: 0 0 10px 0;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        font-weight: 700;
      }

      .stat-card p {
        margin: 0;
        color: #6c757d;
        font-weight: 500;
      }

      /* Tables */
      .table-container {
        overflow-x: auto;
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        border: 1px solid #e2e8f0;
      }

      .data-table {
        width: 100%;
        border-collapse: collapse;
      }

      .data-table th {
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        padding: 15px;
        text-align: left;
        border-bottom: 1px solid #e2e8f0;
        font-weight: 600;
        color: #4a5568;
        font-size: 0.9rem;
      }

      .data-table td {
        padding: 12px 15px;
        border-bottom: 1px solid #f1f3f4;
        color: #2d3748;
      }

      .data-table tr:hover {
        background: #f8f9fa;
      }

      .loading {
        text-align: center;
        color: #718096;
        font-style: italic;
        padding: 40px;
      }

      /* Status Cards */
      .status-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin: 20px 0;
      }

      .status-card {
        background: white;
        border-radius: 12px;
        padding: 25px;
        border: 1px solid #e2e8f0;
        transition: transform 0.3s ease;
      }

      .status-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0,0,0,0.1);
      }

      .status-card h3 {
        color: #4a5568;
        margin-bottom: 15px;
        font-size: 1.2rem;
      }

      .status-indicator {
        font-size: 1.1rem;
        margin-top: 10px;
        font-weight: 500;
      }

      .system-actions {
        margin-top: 30px;
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
      }

      /* Filters */
      .audit-filters {
        display: flex;
        gap: 15px;
        margin-bottom: 25px;
        align-items: center;
        flex-wrap: wrap;
      }

      .audit-filters input {
        padding: 10px 12px;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        font-size: 0.9rem;
        transition: border-color 0.3s ease;
        background: #f7fafc;
      }

      .audit-filters input:focus {
        outline: none;
        border-color: #667eea;
        background: white;
      }

      /* Status Badges */
      .status-active {
        background: #d4edda;
        color: #155724;
        padding: 6px 10px;
        border-radius: 6px;
        font-size: 0.8rem;
        font-weight: 500;
      }

      .status-inactive {
        background: #f8d7da;
        color: #721c24;
        padding: 6px 10px;
        border-radius: 6px;
        font-size: 0.8rem;
        font-weight: 500;
      }

      /* Action Buttons */
      .action-btn {
        background: #6c757d;
        color: white;
        border: none;
        padding: 6px 12px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 0.8rem;
        margin: 0 3px;
        transition: all 0.3s ease;
        font-weight: 500;
      }

      .action-btn:hover {
        background: #5a6268;
        transform: translateY(-1px);
      }

      .action-btn.danger {
        background: #dc3545;
      }

      .action-btn.danger:hover {
        background: #c82333;
      }

      /* Mobile Responsiveness */
      @media (max-width: 768px) {
        .container {
          padding: 15px;
        }

        h1 {
          font-size: 2rem;
        }

        nav {
          padding: 10px;
        }

        .nav-btn {
          padding: 8px 12px;
          font-size: 0.8rem;
        }

        .section {
          padding: 20px;
        }

        .section-header {
          flex-direction: column;
          align-items: stretch;
        }

        .stats-grid {
          grid-template-columns: 1fr;
        }

        .system-actions {
          flex-direction: column;
        }

        .audit-filters {
          flex-direction: column;
          align-items: stretch;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>UM-OIC Administration</h1>

      <div id="loading" class="loading">
        Authentifizierung wird √ºberpr√ºft...
      </div>

      <div id="error" class="error" style="display: none;"></div>

      <div id="admin-panel" class="admin-panel">
        <!-- Navigation -->
        <nav style="background: #f8f9fa; padding: 10px; border-radius: 6px; margin-bottom: 20px;">
          <button onclick="showSection('dashboard')" class="nav-btn active" id="nav-dashboard">Dashboard</button>
          <button onclick="showSection('users')" class="nav-btn" id="nav-users">Benutzer</button>
          <button onclick="showSection('orgs')" class="nav-btn" id="nav-orgs">Organisationen</button>
          <button onclick="showSection('clients')" class="nav-btn" id="nav-clients">Clients</button>
          <button onclick="showSection('system')" class="nav-btn" id="nav-system">System</button>
          <button onclick="showSection('audit')" class="nav-btn" id="nav-audit">Audit</button>
          <button onclick="logout()" style="margin-left: auto; background: #dc3545;">Abmelden</button>
        </nav>

        <!-- Dashboard Section -->
        <div id="section-dashboard" class="section active">
          <h2>UM-OIC Administration Dashboard</h2>
          <div class="stats-grid">
            <div class="stat-card">
              <h3 id="stats-users">-</h3>
              <p>Benutzer</p>
            </div>
            <div class="stat-card">
              <h3 id="stats-orgs">-</h3>
              <p>Organisationen</p>
            </div>
            <div class="stat-card">
              <h3 id="stats-clients">-</h3>
              <p>Clients</p>
            </div>
            <div class="stat-card">
              <h3 id="stats-orgs">-</h3>
              <p>Organisationen</p>
            </div>
          </div>
        </div>

        <!-- Users Section -->
        <div id="section-users" class="section">
          <div class="section-header">
            <h2>Benutzerverwaltung</h2>
            <button onclick="showCreateUserModal()" class="btn-primary">Neuer Benutzer</button>
          </div>
          <div class="table-container">
            <table id="users-table" class="data-table">
              <thead>
                <tr>
                  <th>E-Mail</th>
                  <th>Name</th>
                  <th>Organisation</th>
                  <th>Status</th>
                  <th>Rollen</th>
                  <th>Aktionen</th>
                </tr>
              </thead>
              <tbody id="users-tbody">
                <tr><td colspan="6" class="loading">Laden...</td></tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Organizations Section -->
        <div id="section-orgs" class="section">
          <div class="section-header">
            <h2>Organisationen</h2>
            <button onclick="showCreateOrgModal()" class="btn-primary">Neue Organisation</button>
          </div>
          <div class="table-container">
            <table id="orgs-table" class="data-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Beschreibung</th>
                  <th>Mitglieder</th>
                  <th>Aktionen</th>
                </tr>
              </thead>
              <tbody id="orgs-tbody">
                <tr><td colspan="4" class="loading">Laden...</td></tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Clients Section -->
        <div id="section-clients" class="section">
          <div class="section-header">
            <h2>OAuth2-Client Management</h2>
            <button onclick="showCreateClientModal()" class="btn-primary">Neuer Client</button>
          </div>
          <div class="table-container">
            <table id="clients-table" class="data-table">
              <thead>
                <tr>
                  <th>Client ID</th>
                  <th>Name</th>
                  <th>Typ</th>
                  <th>Redirect URIs</th>
                  <th>Aktionen</th>
                </tr>
              </thead>
              <tbody id="clients-tbody">
                <tr><td colspan="5" class="loading">Laden...</td></tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- System Section -->
        <div id="section-system" class="section">
          <h2>System-Status</h2>
          <div class="status-grid">
            <div class="status-card">
              <h3>Auth Service</h3>
              <div id="auth-status" class="status-indicator">üîç Pr√ºfen...</div>
            </div>
            <div class="status-card">
              <h3>Admin Service</h3>
              <div id="admin-status" class="status-indicator">‚úÖ Online</div>
            </div>
            <div class="status-card">
              <h3>Daten-Synchronisation</h3>
              <div id="data-status" class="status-indicator">üîç Pr√ºfen...</div>
            </div>
          </div>
          <div class="system-actions">
            <button onclick="reloadAuthData()" class="btn-warning">Auth-Daten neu laden</button>
            <button onclick="refreshSystemStatus()" class="btn-secondary">Status aktualisieren</button>
          </div>
        </div>

        <!-- Audit Section -->
        <div id="section-audit" class="section">
          <h2>Audit-Logs</h2>
          <div class="audit-filters">
            <input type="text" id="audit-user-filter" placeholder="Benutzer-ID">
            <input type="text" id="audit-event-filter" placeholder="Event-Typ">
            <button onclick="loadAuditLogs()" class="btn-secondary">Filtern</button>
          </div>
          <div class="table-container">
            <table id="audit-table" class="data-table">
              <thead>
                <tr>
                  <th>Zeitstempel</th>
                  <th>Event</th>
                  <th>Benutzer</th>
                  <th>Details</th>
                </tr>
              </thead>
              <tbody id="audit-tbody">
                <tr><td colspan="4" class="loading">Laden...</td></tr>
              </tbody>
            </table>
          </div>
        </div>

        <div class="cache-info">
          Cache-Buster: <span id="cache-version">v1.0</span>
        </div>
      </div>
    </div>

    <script>
      // Check authentication on page load
      document.addEventListener('DOMContentLoaded', function() {
        checkAuthentication();
      });

      function checkAuthentication() {
        console.log('Checking authentication...');

        // Check for token in URL parameters (from auth service redirect)
        const urlParams = new URLSearchParams(window.location.search);
        const tokenFromUrl = urlParams.get('token');

        if (tokenFromUrl) {
          console.log('Token found in URL, storing...');
          localStorage.setItem('auth_token', tokenFromUrl);
          // Clean URL
          window.history.replaceState({}, document.title, window.location.pathname);
        }

        // Check for stored token
        const token = localStorage.getItem('auth_token');

        if (!token) {
          console.log('No token found, redirecting to auth service...');
          redirectToAuth();
          return;
        }

        console.log('Token found, validating...');
        validateToken(token);
      }

      function redirectToAuth() {
        const currentUrl = encodeURIComponent(window.location.href);
        const authUrl = `https://localhost:8443/?redirect=${currentUrl}`;
        console.log('Redirecting to:', authUrl);
        window.location.href = authUrl;
      }

      async function validateToken(token) {
        try {
          const timestamp = Date.now();
          const response = await fetch(`/api/system/status?_cb=${timestamp}`, {
            headers: {
              'Authorization': `Bearer ${token}`,
              'Cache-Control': 'no-cache, no-store, must-revalidate',
              'Pragma': 'no-cache',
              'Expires': '0'
            }
          });

          if (response.ok) {
            console.log('‚úÖ Token valid, showing admin panel');
            showAdminPanel();
          } else {
            const errorText = await response.text().catch(() => 'Unknown error');
            console.warn('‚ùå Token invalid:', response.status, response.statusText, errorText);
            showError(`Token ung√ºltig (${response.status}): ${response.statusText}. Sie werden zum Login weitergeleitet...`);
            localStorage.removeItem('auth_token');
            setTimeout(() => redirectToAuth(), 2000);
          }
        } catch (error) {
          console.error('üî• Token validation error:', error);
          showError('Verbindungsfehler bei der Token-Validierung: ' + error.message + '. Versuche erneut...');
          setTimeout(() => redirectToAuth(), 3000);
        }
      }

      function showAdminPanel() {
        document.getElementById('loading').style.display = 'none';
        document.getElementById('error').style.display = 'none';
        document.getElementById('admin-panel').style.display = 'block';

        // Update cache buster version to show successful login
        const cacheVersion = document.getElementById('cache-version');
        if (cacheVersion) {
          cacheVersion.textContent = `v${Date.now()}`;
        }
      }

      function showError(message) {
        document.getElementById('loading').style.display = 'none';
        document.getElementById('error').textContent = message;
        document.getElementById('error').style.display = 'block';
      }

      function logout() {
        localStorage.removeItem('auth_token');
        window.location.href = 'https://localhost:8443/';
      }

      // Navigation functionality
      function showSection(sectionName) {
        // Hide all sections
        document.querySelectorAll('.section').forEach(section => {
          section.classList.remove('active');
        });

        // Remove active from all nav buttons
        document.querySelectorAll('.nav-btn').forEach(btn => {
          btn.classList.remove('active');
        });

        // Show target section
        document.getElementById(`section-${sectionName}`).classList.add('active');
        document.getElementById(`nav-${sectionName}`).classList.add('active');

        // Load section data
        switch(sectionName) {
          case 'dashboard':
            loadDashboard();
            break;
          case 'users':
            loadUsers();
            break;
          case 'orgs':
            loadOrgs();
            break;
          case 'clients':
            loadClients();
            break;
          case 'system':
            loadSystemStatus();
            break;
          case 'audit':
            loadAuditLogs();
            break;
        }
      }

      // API helper function
      async function apiCall(endpoint, options = {}) {
        const token = localStorage.getItem('auth_token');
        const defaultOptions = {
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json',
            'Cache-Control': 'no-cache'
          }
        };

        const mergedOptions = {
          ...defaultOptions,
          ...options,
          headers: {
            ...defaultOptions.headers,
            ...(options.headers || {})
          }
        };

        try {
          const response = await fetch(endpoint, mergedOptions);
          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }
          return await response.json();
        } catch (error) {
          console.error('API call failed:', error);
          throw error;
        }
      }

      // Dashboard functionality
      async function loadDashboard() {
        try {
          const stats = await apiCall('/api/system/stats');

          document.getElementById('stats-users').textContent = stats.users || '-';
          document.getElementById('stats-orgs').textContent = stats.organizations || '-';
          document.getElementById('stats-clients').textContent = stats.clients || '-';
          document.getElementById('stats-orgs').textContent = stats.organizations || '-';
        } catch (error) {
          console.error('Failed to load dashboard stats:', error);
          document.getElementById('stats-users').textContent = 'Fehler';
          document.getElementById('stats-groups').textContent = 'Fehler';
          document.getElementById('stats-clients').textContent = 'Fehler';
          document.getElementById('stats-orgs').textContent = 'Fehler';
        }
      }

      // Users functionality
      async function loadUsers() {
        const tbody = document.getElementById('users-tbody');
        tbody.innerHTML = '<tr><td colspan="6" class="loading">Laden...</td></tr>';

        try {
          const users = await apiCall('/api/users');

          if (users.length === 0) {
            tbody.innerHTML = '<tr><td colspan="6" class="loading">Keine Benutzer gefunden</td></tr>';
            return;
          }

          tbody.innerHTML = users.map(user => `
            <tr>
              <td>${user.email}</td>
              <td>${user.first_name} ${user.last_name}</td>
              <td>${user.org || '-'}</td>
              <td>
                <span class="status-${user.status === 'active' ? 'active' : 'inactive'}">
                  ${user.status === 'active' ? 'Aktiv' : 'Inaktiv'}
                </span>
              </td>
              <td>${user.admin ? user.admin.join(', ') : '-'}</td>
              <td>
                <button class="action-btn" onclick="editUser('${user.id}')">Bearbeiten</button>
                <button class="action-btn danger" onclick="deleteUser('${user.id}')">L√∂schen</button>
              </td>
            </tr>
          `).join('');
        } catch (error) {
          console.error('Failed to load users:', error);
          tbody.innerHTML = '<tr><td colspan="6" class="loading">Fehler beim Laden der Benutzer</td></tr>';
        }
      }

      // Organizations functionality
      async function loadOrgs() {
        const tbody = document.getElementById('orgs-tbody');
        tbody.innerHTML = '<tr><td colspan="4" class="loading">Laden...</td></tr>';

        try {
          const orgs = await apiCall('/api/orgs');

          if (orgs.length === 0) {
            tbody.innerHTML = '<tr><td colspan="4" class="loading">Keine Organisationen gefunden</td></tr>';
            return;
          }

          tbody.innerHTML = orgs.map(org => `
            <tr>
              <td>${org.name}</td>
              <td>${org.description || '-'}</td>
              <td>${org.member_count || 0}</td>
              <td>
                <button class="action-btn" onclick="editOrg('${org.id}')">Bearbeiten</button>
                <button class="action-btn danger" onclick="deleteOrg('${org.id}')">L√∂schen</button>
              </td>
            </tr>
          `).join('');
        } catch (error) {
          console.error('Failed to load orgs:', error);
          tbody.innerHTML = '<tr><td colspan="4" class="loading">Fehler beim Laden der Organisationen</td></tr>';
        }
      }

      // Clients functionality
      async function loadClients() {
        const tbody = document.getElementById('clients-tbody');
        tbody.innerHTML = '<tr><td colspan="5" class="loading">Laden...</td></tr>';

        try {
          const clients = await apiCall('/api/clients');

          if (clients.length === 0) {
            tbody.innerHTML = '<tr><td colspan="5" class="loading">Keine Clients gefunden</td></tr>';
            return;
          }

          tbody.innerHTML = clients.map(client => `
            <tr>
              <td>${client.client_id}</td>
              <td>${client.name}</td>
              <td>${client.client_type || 'confidential'}</td>
              <td>${client.redirect_uris ? client.redirect_uris.slice(0, 2).join(', ') : '-'}</td>
              <td>
                <button class="action-btn" onclick="editClient('${client.client_id}')">Bearbeiten</button>
                <button class="action-btn danger" onclick="deleteClient('${client.client_id}')">L√∂schen</button>
              </td>
            </tr>
          `).join('');
        } catch (error) {
          console.error('Failed to load clients:', error);
          tbody.innerHTML = '<tr><td colspan="5" class="loading">Fehler beim Laden der Clients</td></tr>';
        }
      }

      // System status functionality
      async function loadSystemStatus() {
        try {
          const status = await apiCall('/api/system/status');

          document.getElementById('auth-status').textContent =
            status.auth_service ? '‚úÖ Online' : '‚ùå Offline';
          document.getElementById('admin-status').textContent = '‚úÖ Online';
          document.getElementById('data-status').textContent =
            status.data_sync ? '‚úÖ Synchronisiert' : '‚ö†Ô∏è Synchronisation erforderlich';
        } catch (error) {
          console.error('Failed to load system status:', error);
          document.getElementById('auth-status').textContent = '‚ùå Fehler';
          document.getElementById('data-status').textContent = '‚ùå Fehler';
        }
      }

      // Audit logs functionality
      async function loadAuditLogs() {
        const tbody = document.getElementById('audit-tbody');
        tbody.innerHTML = '<tr><td colspan="4" class="loading">Laden...</td></tr>';

        try {
          const logs = await apiCall('/api/audit/logs');

          if (logs.length === 0) {
            tbody.innerHTML = '<tr><td colspan="4" class="loading">Keine Audit-Logs gefunden</td></tr>';
            return;
          }

          tbody.innerHTML = logs.map(log => `
            <tr>
              <td>${new Date(log.timestamp).toLocaleString('de-DE')}</td>
              <td>${log.event_type}</td>
              <td>${log.user_id || '-'}</td>
              <td>${log.details || '-'}</td>
            </tr>
          `).join('');
        } catch (error) {
          console.error('Failed to load audit logs:', error);
          tbody.innerHTML = '<tr><td colspan="4" class="loading">Fehler beim Laden der Audit-Logs</td></tr>';
        }
      }

      // System actions
      async function reloadAuthData() {
        try {
          await apiCall('/api/system/reload', { method: 'POST' });
          alert('Auth-Daten wurden neu geladen');
          loadSystemStatus();
        } catch (error) {
          alert('Fehler beim Neuladen der Auth-Daten: ' + error.message);
        }
      }

      async function refreshSystemStatus() {
        loadSystemStatus();
      }

      // User actions (placeholders)
      function editUser(userId) {
        alert(`Benutzer bearbeiten: ${userId} (noch nicht implementiert)`);
      }

      function deleteUser(userId) {
        if (confirm(`Benutzer ${userId} wirklich l√∂schen?`)) {
          alert(`L√∂schen von ${userId} (noch nicht implementiert)`);
        }
      }

      function showCreateUserModal() {
        alert('Benutzer erstellen (noch nicht implementiert)');
      }

      // Organization actions (placeholders)
      function editOrg(orgId) {
        alert(`Organisation bearbeiten: ${orgId} (noch nicht implementiert)`);
      }

      function deleteOrg(orgId) {
        if (confirm(`Organisation ${orgId} wirklich l√∂schen?`)) {
          alert(`L√∂schen von ${orgId} (noch nicht implementiert)`);
        }
      }

      function showCreateOrgModal() {
        alert('Organisation erstellen (noch nicht implementiert)');
      }

      // Client actions (placeholders)
      function editClient(clientId) {
        alert(`Client bearbeiten: ${clientId} (noch nicht implementiert)`);
      }

      function deleteClient(clientId) {
        if (confirm(`Client ${clientId} wirklich l√∂schen?`)) {
          alert(`L√∂schen von ${clientId} (noch nicht implementiert)`);
        }
      }

      function showCreateClientModal() {
        alert('Client erstellen (noch nicht implementiert)');
      }

      // Load dashboard on startup
      document.addEventListener('DOMContentLoaded', function() {
        checkAuthentication();

        // Load dashboard data after successful auth
        setTimeout(() => {
          if (document.getElementById('admin-panel').style.display !== 'none') {
            loadDashboard();
          }
        }, 1000);
      });
    </script>
  </body>
</html>